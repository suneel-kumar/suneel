<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>sample POC </title>

    <base href="/" />

    <meta name="viewport"
        content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.3.200/pdf.js" integrity="sha256-WpyZntIney4QnkFnP2qOwoLJsCTFFpLyi08ZWh/LXPE=" crossorigin="anonymous"></script>

</head>

<body>
    <h1>Sample image getting rendered with binary data which is received as part of payload structure </h1>
    <div id="image"></div>
    <br />
    <h1>Sample pdf getting rendered with binary data which is received as part of payload structure </h1>
    <canvas id="the-canvas" style="border: 1px solid black; direction: ltr;width:1000px;height:1300px;"></canvas>

    <script>

        function hexToBase64(str) {
            return btoa(String.fromCharCode.apply(null, str.replace(/\r|\n/g, "").replace(/([\da-fA-F]{2}) ?/g, "0x$1 ").replace(/ +$/, "").split(" ")));
        }
        var xmlhttp = new XMLHttpRequest();
        var url = "http://schneiderapp.herokuapp.com/image-data";

        xmlhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var myArr = JSON.parse(this.responseText);
                var img = new Image();
                img.src = "data:image/jpeg;base64," + hexToBase64(myArr.data);
                document.getElementById("image").appendChild(img);
            }
        };
        xmlhttp.open("GET", url, true);
        xmlhttp.send();


        function showFile(blob) {

            var newBlob = new Blob([blob], { type: "application/pdf" })

            if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                window.navigator.msSaveOrOpenBlob(newBlob);
                return;
            }

            const data = window.URL.createObjectURL(newBlob);

        //     function sample() {

        //         if (typeof window === "undefined" || typeof navigator === "undefined") { return false; }

        //         var pdfobjectversion = "2.1.1",
        //             ua = window.navigator.userAgent,
        //             supportsPDFs,
        //             isIE,
        //             supportsPdfMimeType = (typeof navigator.mimeTypes['application/pdf'] !== "undefined"),
        //             supportsPdfActiveX,
        //             isModernBrowser = (function () { return (typeof window.Promise !== "undefined"); })(),
        //             isFirefox = (function () { return (ua.indexOf("irefox") !== -1); })(),
        //             isFirefoxWithPDFJS = (function () {
        //                 if (!isFirefox) { return false; }
        //                 return (parseInt(ua.split("rv:")[1].split(".")[0], 10) > 18);
        //             })(),
        //             isIOS = (function () { return (/iphone|ipad|ipod/i.test(ua.toLowerCase())); })(),
        //             createAXO,
        //             buildFragmentString,
        //             log,
        //             embedError,
        //             embed,
        //             getTargetElement,
        //             generatePDFJSiframe,
        //             generateEmbedElement;

        //         createAXO = function (type) {
        //             var ax;
        //             try {
        //                 ax = new ActiveXObject(type);
        //             } catch (e) {
        //                 ax = null;
        //             }
        //             return ax;
        //         };

        //         isIE = function () { return !!(window.ActiveXObject || "ActiveXObject" in window); };
        //         supportsPdfActiveX = function () { return !!(createAXO("AcroPDF.PDF") || createAXO("PDF.PdfCtrl")); };
        //         supportsPDFs = (
        //             !isIOS && (
        //                 isFirefoxWithPDFJS ||
        //                 supportsPdfMimeType || (
        //                     isIE() && supportsPdfActiveX()
        //                 )
        //             )
        //         );
        //         buildFragmentString = function (pdfParams) {
        //             var string = "",
        //                 prop;
        //             if (pdfParams) {
        //                 for (prop in pdfParams) {
        //                     if (pdfParams.hasOwnProperty(prop)) {
        //                         string += encodeURIComponent(prop) + "=" + encodeURIComponent(pdfParams[prop]) + "&";
        //                     }
        //                 }
        //                 if (string) {

        //                     string = "#" + string;
        //                     string = string.slice(0, string.length - 1);
        //                 }
        //             }
        //             return string;
        //         };

        //         log = function (msg) {
        //             if (typeof console !== "undefined" && console.log) {
        //                 console.log("[PDFObject] " + msg);
        //             }
        //         };

        //         embedError = function (msg) {
        //             log(msg);
        //             return false;
        //         };

        //         getTargetElement = function (targetSelector) {
        //             return targetSelector;
        //         };

        //         generatePDFJSiframe = function (targetNode, url, pdfOpenFragment, PDFJS_URL, id) {
        //             var fullURL = PDFJS_URL + "?file=" + encodeURIComponent(url) + pdfOpenFragment;
        //             var scrollfix = (isIOS) ? "-webkit-overflow-scrolling: touch; overflow-y: scroll; " : "overflow: hidden; ";
        //             var iframe = "<div style='" + scrollfix + "position: absolute; top: 0; right: 0; bottom: 0; left: 0;'><iframe  " + id + " src='" + fullURL + "' style='border: none; width: 100%; height: 100%;' frameborder='0'></iframe></div>";
        //             targetNode.className += " pdfobject-container";
        //             targetNode.style.position = "relative";
        //             targetNode.style.overflow = "auto";
        //             targetNode.innerHTML = iframe;
        //             return targetNode.getElementsByTagName("iframe")[0];
        //         };

        //         generateEmbedElement = function (targetNode, targetSelector, url, pdfOpenFragment, width, height, id) {
        //             var style = "";
        //             if (targetSelector && targetSelector !== document.body) {
        //                 style = "width: " + width + "; height: " + height + ";";
        //             } else {
        //                 style = "position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%;";
        //             }
        //             targetNode.className += " pdfobject-container";
        //             targetNode.innerHTML = "<embed " + id + " class='pdfobject' src='" + url + pdfOpenFragment + "' type='application/pdf' style='overflow: auto; " + style + "'/>";

        //             return targetNode.getElementsByTagName("embed")[0];
        //         };

        //         embed = function (url, targetSelector, options) {
        //             if (typeof url !== "string") { return embedError("URL is not valid"); }
        //             targetSelector = (typeof targetSelector !== "undefined") ? targetSelector : false;
        //             options = (typeof options !== "undefined") ? options : {};
        //             var id = (options.id && typeof options.id === "string") ? "id='" + options.id + "'" : "",
        //                 page = (options.page) ? options.page : false,
        //                 pdfOpenParams = (options.pdfOpenParams) ? options.pdfOpenParams : {},
        //                 fallbackLink = (typeof options.fallbackLink !== "undefined") ? options.fallbackLink : true,
        //                 width = (options.width) ? options.width : "100%",
        //                 height = (options.height) ? options.height : "100%",
        //                 assumptionMode = (typeof options.assumptionMode === "boolean") ? options.assumptionMode : true,
        //                 forcePDFJS = (typeof options.forcePDFJS === "boolean") ? options.forcePDFJS : false,
        //                 PDFJS_URL = (options.PDFJS_URL) ? options.PDFJS_URL : false,
        //                 targetNode = getTargetElement(targetSelector),
        //                 fallbackHTML = "",
        //                 pdfOpenFragment = "",
        //                 fallbackHTML_default = "<p>This browser does not support inline PDFs. Please download the PDF to view it: <a href='[url]'>Download PDF</a></p>";
        //             if (!targetNode) { return embedError("Target element cannot be determined"); }
        //             if (page) {
        //                 pdfOpenParams.page = page;
        //             }
        //             pdfOpenFragment = buildFragmentString(pdfOpenParams);
        //             if (forcePDFJS && PDFJS_URL) {
        //                 return generatePDFJSiframe(targetNode, url, pdfOpenFragment, PDFJS_URL, id);
        //             } else if (supportsPDFs || (assumptionMode && isModernBrowser && !isIOS)) {
        //                 return generateEmbedElement(targetNode, targetSelector, url, pdfOpenFragment, width, height, id);
        //             } else if (PDFJS_URL) {
        //                 return generatePDFJSiframe(targetNode, url, pdfOpenFragment, PDFJS_URL, id);
        //             } else {
        //                 if (fallbackLink) {
        //                     fallbackHTML = (typeof fallbackLink === "string") ? fallbackLink : fallbackHTML_default;
        //                     targetNode.innerHTML = fallbackHTML.replace(/\[url\]/g, url);
        //                 }
        //                 return embedError("This browser does not support embedded PDFs");
        //             }

        //         };

        //         return {
        //             embed: function (a, b, c) { return embed(a, b, c); },
        //             pdfobjectversion: (function () { return pdfobjectversion; })(),
        //             supportsPDFs: (function () { return supportsPDFs; })()
        //         };

        //     };

        //     sample().embed(data, document.getElementById("pdf"));
        //     setTimeout(function () {
        //         window.URL.revokeObjectURL(data);
        //     }, 100);
        // }
//
  // If absolute URL from the remote server is provided, configure the CORS
  // header on that server.
  //

  //
  // The workerSrc property shall be specified.
  //
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';

  //
  // Asynchronous download PDF
  //
  var loadingTask = pdfjsLib.getDocument({data: data});
  loadingTask.promise.then(function(pdf) {
    //
    // Fetch the first page
    //
    pdf.getPage(1).then(function(page) {
      var scale = 1.5;
      var viewport = page.getViewport({ scale: scale, });

      //
      // Prepare canvas using PDF page dimensions
      //
      var canvas = document.getElementById('the-canvas');
      var context = canvas.getContext('2d');
      canvas.height = viewport.height;
      canvas.width = viewport.width;

      //
      // Render PDF page into canvas context
      //
      var renderContext = {
        canvasContext: context,
        viewport: viewport,
      };
      page.render(renderContext);
    });
  });


}

        fetch(["/1.pdf"], {})
            .then(r => r.blob())
            .then(showFile)

    </script>
</body>

</html>
